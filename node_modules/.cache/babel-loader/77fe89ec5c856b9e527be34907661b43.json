{"ast":null,"code":"import * as api from '../api';\nimport { setDoctors, setLocker } from '../store/index';\n\n/**\r\n * HELPER: Gets token from State or LocalStorage\r\n * This ensures the \"Authorization header missing\" error is solved.\r\n */\nconst getValidToken = state => {\n  var _state$session, _state$session2, _state$auth;\n  // 1. Try Redux State first\n  let token = ((_state$session = state.session) === null || _state$session === void 0 ? void 0 : _state$session.authToken) || ((_state$session2 = state.session) === null || _state$session2 === void 0 ? void 0 : _state$session2.token) || ((_state$auth = state.auth) === null || _state$auth === void 0 ? void 0 : _state$auth.token);\n\n  // 2. Fallback to LocalStorage (This is where your screenshot showed user data)\n  if (!token) {\n    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser') || '{}');\n    token = loggedInUser.token || localStorage.getItem('token');\n  }\n  return token;\n};\n\n// 1. FETCH DOCTORS - Fixes Search & Red/Green Slot visibility\nexport const getDoctors = name => async (dispatch, getState) => {\n  try {\n    const token = getValidToken(getState());\n    if (!token) {\n      console.error(\"❌ No token found. Please logout and login again.\");\n      return;\n    }\n    const {\n      data\n    } = await api.searchDoctors(name, token);\n    dispatch(setDoctors(data));\n    console.log(\"✅ Doctors and availability slots loaded.\");\n  } catch (error) {\n    var _error$response;\n    console.error(\"Search Error:\", ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n  }\n};\n\n// 2. FETCH LOCKER - Fixes Medical Records/Profile visibility\nexport const getLocker = username => async (dispatch, getState) => {\n  try {\n    const token = getValidToken(getState());\n    if (!token) {\n      console.error(\"❌ No token found.\");\n      return;\n    }\n    const {\n      data\n    } = await api.fetchLocker(username, token);\n    dispatch(setLocker(data));\n    console.log(\"✅ Medical Locker data loaded.\");\n  } catch (error) {\n    var _error$response2;\n    console.error(\"Locker Error:\", ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || error.message);\n  }\n};","map":{"version":3,"names":["api","setDoctors","setLocker","getValidToken","state","_state$session","_state$session2","_state$auth","token","session","authToken","auth","loggedInUser","JSON","parse","localStorage","getItem","getDoctors","name","dispatch","getState","console","error","data","searchDoctors","log","_error$response","response","message","getLocker","username","fetchLocker","_error$response2"],"sources":["D:/Niharika/WT Project/Medicus/src/Actions/patient.js"],"sourcesContent":["import * as api from '../api';\r\nimport { setDoctors, setLocker } from '../store/index'; \r\n\r\n/**\r\n * HELPER: Gets token from State or LocalStorage\r\n * This ensures the \"Authorization header missing\" error is solved.\r\n */\r\nconst getValidToken = (state) => {\r\n    // 1. Try Redux State first\r\n    let token = state.session?.authToken || state.session?.token || state.auth?.token;\r\n    \r\n    // 2. Fallback to LocalStorage (This is where your screenshot showed user data)\r\n    if (!token) {\r\n        const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser') || '{}');\r\n        token = loggedInUser.token || localStorage.getItem('token');\r\n    }\r\n    \r\n    return token;\r\n};\r\n\r\n// 1. FETCH DOCTORS - Fixes Search & Red/Green Slot visibility\r\nexport const getDoctors = (name) => async (dispatch, getState) => {\r\n    try {\r\n        const token = getValidToken(getState());\r\n\r\n        if (!token) {\r\n            console.error(\"❌ No token found. Please logout and login again.\");\r\n            return;\r\n        }\r\n\r\n        const { data } = await api.searchDoctors(name, token);\r\n        dispatch(setDoctors(data)); \r\n        console.log(\"✅ Doctors and availability slots loaded.\");\r\n    } catch (error) {\r\n        console.error(\"Search Error:\", error.response?.data || error.message);\r\n    }\r\n};\r\n\r\n// 2. FETCH LOCKER - Fixes Medical Records/Profile visibility\r\nexport const getLocker = (username) => async (dispatch, getState) => {\r\n    try {\r\n        const token = getValidToken(getState());\r\n\r\n        if (!token) {\r\n            console.error(\"❌ No token found.\");\r\n            return;\r\n        }\r\n\r\n        const { data } = await api.fetchLocker(username, token);\r\n        dispatch(setLocker(data)); \r\n        console.log(\"✅ Medical Locker data loaded.\");\r\n    } catch (error) {\r\n        console.error(\"Locker Error:\", error.response?.data || error.message);\r\n    }\r\n};"],"mappings":"AAAA,OAAO,KAAKA,GAAG,MAAM,QAAQ;AAC7B,SAASC,UAAU,EAAEC,SAAS,QAAQ,gBAAgB;;AAEtD;AACA;AACA;AACA;AACA,MAAMC,aAAa,GAAIC,KAAK,IAAK;EAAA,IAAAC,cAAA,EAAAC,eAAA,EAAAC,WAAA;EAC7B;EACA,IAAIC,KAAK,GAAG,EAAAH,cAAA,GAAAD,KAAK,CAACK,OAAO,cAAAJ,cAAA,uBAAbA,cAAA,CAAeK,SAAS,OAAAJ,eAAA,GAAIF,KAAK,CAACK,OAAO,cAAAH,eAAA,uBAAbA,eAAA,CAAeE,KAAK,OAAAD,WAAA,GAAIH,KAAK,CAACO,IAAI,cAAAJ,WAAA,uBAAVA,WAAA,CAAYC,KAAK;;EAEjF;EACA,IAAI,CAACA,KAAK,EAAE;IACR,MAAMI,YAAY,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,IAAI,IAAI,CAAC;IAC7ER,KAAK,GAAGI,YAAY,CAACJ,KAAK,IAAIO,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC/D;EAEA,OAAOR,KAAK;AAChB,CAAC;;AAED;AACA,OAAO,MAAMS,UAAU,GAAIC,IAAI,IAAK,OAAOC,QAAQ,EAAEC,QAAQ,KAAK;EAC9D,IAAI;IACA,MAAMZ,KAAK,GAAGL,aAAa,CAACiB,QAAQ,CAAC,CAAC,CAAC;IAEvC,IAAI,CAACZ,KAAK,EAAE;MACRa,OAAO,CAACC,KAAK,CAAC,kDAAkD,CAAC;MACjE;IACJ;IAEA,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMvB,GAAG,CAACwB,aAAa,CAACN,IAAI,EAAEV,KAAK,CAAC;IACrDW,QAAQ,CAAClB,UAAU,CAACsB,IAAI,CAAC,CAAC;IAC1BF,OAAO,CAACI,GAAG,CAAC,0CAA0C,CAAC;EAC3D,CAAC,CAAC,OAAOH,KAAK,EAAE;IAAA,IAAAI,eAAA;IACZL,OAAO,CAACC,KAAK,CAAC,eAAe,EAAE,EAAAI,eAAA,GAAAJ,KAAK,CAACK,QAAQ,cAAAD,eAAA,uBAAdA,eAAA,CAAgBH,IAAI,KAAID,KAAK,CAACM,OAAO,CAAC;EACzE;AACJ,CAAC;;AAED;AACA,OAAO,MAAMC,SAAS,GAAIC,QAAQ,IAAK,OAAOX,QAAQ,EAAEC,QAAQ,KAAK;EACjE,IAAI;IACA,MAAMZ,KAAK,GAAGL,aAAa,CAACiB,QAAQ,CAAC,CAAC,CAAC;IAEvC,IAAI,CAACZ,KAAK,EAAE;MACRa,OAAO,CAACC,KAAK,CAAC,mBAAmB,CAAC;MAClC;IACJ;IAEA,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMvB,GAAG,CAAC+B,WAAW,CAACD,QAAQ,EAAEtB,KAAK,CAAC;IACvDW,QAAQ,CAACjB,SAAS,CAACqB,IAAI,CAAC,CAAC;IACzBF,OAAO,CAACI,GAAG,CAAC,+BAA+B,CAAC;EAChD,CAAC,CAAC,OAAOH,KAAK,EAAE;IAAA,IAAAU,gBAAA;IACZX,OAAO,CAACC,KAAK,CAAC,eAAe,EAAE,EAAAU,gBAAA,GAAAV,KAAK,CAACK,QAAQ,cAAAK,gBAAA,uBAAdA,gBAAA,CAAgBT,IAAI,KAAID,KAAK,CAACM,OAAO,CAAC;EACzE;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}